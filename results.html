<head>
  <link
    href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:400,700"
    rel="stylesheet"
  />
  <link href="style.css" rel="stylesheet" type="text/css" />
  <title>CH Valuess Results</title>
  <link rel="icon" type="x-icon" href="icon.png" />
  <link rel="shortcut icon" type="x-icon" href="icon.png" />
  <meta charset="utf-8" />
  <script>
    version = "focle"; //Remember to update this before making changes to the test itself!
  </script>
</head>
<script type="application/javascript" src="ideologies.js"></script>

<body>
  <h1>CH Values</h1>
  <hr />

  <h1>Results</h1>

  <h2>Style: <span class="weight-300" id="style-label"></span></h2>
  <div class="axis">
    <img id="img-scifi" src="value_images/scifi.svg" height="128pt" />
    <div class="bar scifi" id="bar-scifi">
      <div class="text-wrapper" id="scifi"></div>
    </div>
    <div class="bar historic" id="bar-historic">
      <div class="text-wrapper" id="historic"></div>
    </div>
    <img id="img-historic" src="value_images/historic.svg" height="128pt" />
  </div>
  <h2>Strategy: <span class="weight-300" id="strategy-label"></span></h2>
  <div class="axis">
    <img id="img-attrition" src="value_images/attrition.svg" height="128pt" />
    <div class="bar attrition" id="bar-attrition">
      <div class="text-wrapper" id="attrition"></div>
    </div>
    <div class="bar-maneuver" id="bar-maneuver">
      <div class="text-wrapper" id=-maneuver"></div>
    </div>
    <img id="img-maneuver" src="value_images-maneuver.svg" height="128pt" />
  </div>
  <h2>Attitude: <span class="weight-300" id="attitude-label"></span></h2>
  <div class="axis">
    <img id="img-aggressive" src="value_images/aggressive.svg" height="128pt" />
    <div class="bar aggressive" id="bar-aggressive">
      <div class="text-wrapper" id="aggressive"></div>
    </div>
    <div class="bar diplomatic" id="bar-diplomatic">
      <div class="text-wrapper" id="diplomatic"></div>
    </div>
    <img id="img-diplomatic" src="value_images/diplomatic.svg" height="128pt" />
  </div>
  <h2>Crea: <span class="weight-300" id="crea-label"></span></h2>
  <div class="axis">
    <img id="img-quantity" src="value_images/quantity.svg" height="128pt" />
    <div class="bar quantity" id="bar-quantity">
      <div class="text-wrapper" id="quantity"></div>
    </div>
    <div class="bar quality" id="bar-quality">
      <div class="text-wrapper" id="quality"></div>
    </div>
    <img id="img-quality" src="value_images/quality.svg" height="128pt" />
  </div>
  <h2>Closest Match: <span class="weight-300" id="ideology-label"></span></h2>
  <p>
    Ideological matching is a work in progress, and is much less accurate than
    the values and axes.
  </p>
  <p>
    You can send these results by copying and pasting the URL at the top of the
    page or using the image below. Think your matched ideology was wrong? Want
    to help us calibrate the test? Tell ous and we will calibrate it.
  </p>
  <hr />
  <img src="" id="banner" />
  <button
    class="button"
    onclick="location.href='index.html';"
    style="background-color: #2196f3"
  >
    Back
  </button>
  <br />
  <!-- Website visit statistics - no personal information is collected! -->
  <script type="text/javascript">
    var sc_project = 11325211;
    var sc_invisible = 1;
    var sc_security = "fd9f0659";
    var scJsHost =
      "https:" == document.location.protocol
        ? "https://secure."
        : "http://www.";
    document.write(
      "<sc" +
        "ript type='text/javascript' src='" +
        scJsHost +
        "statcounter.com/counter/counter.js'></" +
        "script>"
    );
  </script>
  <noscript
    ><div class="statcounter">
      <a title="web stats" href="http://statcounter.com/" target="_blank"
        ><img
          class="statcounter"
          src="//c.statcounter.com/11325211/0/fd9f0659/1/"
          alt="web
stats"
      /></a></div
  ></noscript>
  <script>
    function getQueryVariable(variable) {
      var query = window.location.search.substring(1);
      var vars = query.split("&");
      for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split("=");
        if (pair[0] == variable) {
          return pair[1];
        }
      }
      return NaN;
    }

    function setBarValue(name, value) {
      innerel = document.getElementById(name);
      outerel = document.getElementById("bar-" + name);
      outerel.style.width = value + "%";
      innerel.innerHTML = value + "%";
      if (innerel.offsetWidth + 20 > outerel.offsetWidth) {
        innerel.style.visibility = "hidden";
      }
    }

    styleArray = [
      "Sci-Fi",
      "Futuristic",
      "Advanced",
      "Modern",
      "Traditional",
      "Historic",
      "Archaic",
    ];
    stratArray = [
      "Blitzkrieg",
      "Combined Arms Offensive",
      "Special Operations",
      "Situational",
      "Pitched Battles",
      "Attrition Warfare",
      "Trench Warfare",
    ];
    atdArray = [
      "Genocidal",
      "Warmonger",
      "Territorial",
      "Balanced",
      "Diplomatic",
      "Pacifist",
      "Anti-War",
    ];
    creaArray = [
      "Perfectionist",
      "Specialised",
      "Professional Army",
      "Balanced",
      "Optimised",
      "Mass Produced",
      "Strut Horde",
    ];

    function setLabel(val, ary) {
      if (val > 100) {
        return "";
      } else if (val > 90) {
        return ary[0];
      } else if (val > 75) {
        return ary[1];
      } else if (val > 60) {
        return ary[2];
      } else if (val >= 40) {
        return ary[3];
      } else if (val >= 25) {
        return ary[4];
      } else if (val >= 10) {
        return ary[5];
      } else if (val >= 0) {
        return ary[6];
      } else {
        return "";
      }
    }

    scifi = getQueryVariable("e");
    attrition = getQueryVariable("d");
    aggressive = getQueryVariable("g");
    quantity = getQueryVariable("s");
    historic = (100 - scifi).toFixed(1);
    maneuver = (100 - attrition).toFixed(1);
    diplomatic = (100 - aggressive).toFixed(1);
    quality = (100 - quantity).toFixed(1);

    setBarValue("scifi", scifi);
    setBarValue("historic", historic);
    setBarValue("attrition", attrition);
    setBarValue("maneuver", maneuver);
    setBarValue("aggressive", aggressive);
    setBarValue("diplomatic", diplomatic);
    setBarValue("quantity", quantity);
    setBarValue("quality", quality);

    document.getElementById("style-label").innerHTML = setLabel(
      scifi,
      styleArray
    );
    document.getElementById("strategy-label").innerHTML = setLabel(
      attrition,
      stratArray
    );
    document.getElementById("attitude-label").innerHTML = setLabel(
      aggressive,
      atdArray
    );
    document.getElementById("crea-label").innerHTML = setLabel(
      quantity,
      creaArray
    );

    ideology = "";
    ideodist = Infinity;
    for (var i = 0; i < ideologies.length; i++) {
      dist = 0;
      dist += Math.pow(Math.abs(ideologies[i].stats.style - scifi), 2);
      dist += Math.pow(Math.abs(ideologies[i].stats.strat - attrition), 1.73856063);
      dist += Math.pow(Math.abs(ideologies[i].stats.atd - aggressive), 2);
      dist += Math.pow(
        Math.abs(ideologies[i].stats.crea - quantity),
        1.73856063
      );
      if (dist < ideodist) {
        ideology = ideologies[i].name;
        ideodist = dist;
      }
    }
    document.getElementById("ideology-label").innerHTML = ideology;

    function createImage(src, x, y, w, h) {
      img = new Image();
      img.src = src;
      img.onLoad = function () {
        ctx.drawImage(img, x, y, w, h);
      };
    }

    window.onload = function () {
      var c = document.createElement("canvas");
      var ctx = c.getContext("2d");
      c.width = 800;
      c.height = 650;
      ctx.fillStyle = "#EEEEEE";
      ctx.fillRect(0, 0, 800, 650);

      img = document.getElementById("img-scifi");
      ctx.drawImage(img, 20, 170, 100, 100);
      img = document.getElementById("img-historic");
      ctx.drawImage(img, 680, 170, 100, 100);
      img = document.getElementById("img-maneuver");
      ctx.drawImage(img, 20, 290, 100, 100);
      img = document.getElementById("img-attrition");
      ctx.drawImage(img, 680, 290, 100, 100);
      img = document.getElementById("img-aggressive");
      ctx.drawImage(img, 20, 410, 100, 100);
      img = document.getElementById("img-diplomatic");
      ctx.drawImage(img, 680, 410, 100, 100);
      img = document.getElementById("img-quality");
      ctx.drawImage(img, 20, 530, 100, 100);
      img = document.getElementById("img-quantity");
      ctx.drawImage(img, 680, 530, 100, 100);

      ctx.fillStyle = "#222222";
      ctx.fillRect(120, 180, 560, 80);
      ctx.fillRect(120, 300, 560, 80);
      ctx.fillRect(120, 420, 560, 80);
      ctx.fillRect(120, 540, 560, 80);
      ctx.fillStyle = "#f44336";
      ctx.fillRect(120, 184, 5.6 * scifi - 2, 72);
      ctx.fillStyle = "#00897b";
      ctx.fillRect(682 - 5.6 * historic, 184, 5.6 * historic - 2, 72);
      ctx.fillStyle = "#ff9800";
      ctx.fillRect(120, 304, 5.6 * maneuver - 2, 72);
      ctx.fillStyle = "#03a9f4";
      ctx.fillRect(682 - 5.6 * attrition, 304, 5.6 * attrition - 2, 72);
      ctx.fillStyle = "#ffeb3b";
      ctx.fillRect(120, 424, 5.6 * aggressive - 2, 72);
      ctx.fillStyle = "#3f51b5";
      ctx.fillRect(682 - 5.6 * diplomatic, 424, 5.6 * diplomatic - 2, 72);
      ctx.fillStyle = "#8bc34a";
      ctx.fillRect(120, 544, 5.6 * quality - 2, 72);
      ctx.fillStyle = "#9c27b0";
      ctx.fillRect(682 - 5.6 * quantity, 544, 5.6 * quantity - 2, 72);
      ctx.fillStyle = "#222222";
      ctx.font = "700 80px Montserrat";
      ctx.textAlign = "left";
      ctx.fillText("CH Values", 20, 90);
      ctx.font = "50px Montserrat";
      ctx.fillText(ideology, 20, 140);

      ctx.textAlign = "left";
      if (scifi > 30) {
        ctx.fillText(scifi + "%", 130, 237.5);
      }
      if (maneuver > 30) {
        ctx.fillText(maneuver + "%", 130, 357.5);
      }
      if (aggressive > 30) {
        ctx.fillText(aggressive + "%", 130, 477.5);
      }
      if (quality > 30) {
        ctx.fillText(quality + "%", 130, 597.5);
      }
      ctx.textAlign = "right";
      if (historic > 30) {
        ctx.fillText(historic + "%", 670, 237.5);
      }
      if (attrition > 30) {
        ctx.fillText(attrition + "%", 670, 357.5);
      }
      if (diplomatic > 30) {
        ctx.fillText(diplomatic + "%", 670, 477.5);
      }
      if (quantity > 30) {
        ctx.fillText(quantity + "%", 670, 597.5);
      }

      ctx.font = "300 30px Montserrat";
      ctx.fillText("8values.github.io", 780, 60);
      ctx.fillText(version, 780, 90);
      ctx.textAlign = "center";
      ctx.fillText(
        "Style: " + document.getElementById("style-label").innerHTML,
        400,
        175
      );
      ctx.fillText(
        "Strategy: " + document.getElementById("strategy-label").innerHTML,
        400,
        295
      );
      ctx.fillText(
        "Attitude: " + document.getElementById("attitude-label").innerHTML,
        400,
        415
      );
      ctx.fillText(
        "Crea: " + document.getElementById("crea-label").innerHTML,
        400,
        535
      );

      document.getElementById("banner").src = c.toDataURL();
    };
  </script>
</body>
